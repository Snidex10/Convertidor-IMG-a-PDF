<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertidor de Imágenes a PDF</title>
    <!-- Incluye Tailwind CSS para un diseño responsivo y moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluye la fuente Inter de Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Un gris claro para el fondo */
        }
        /* Estilos para el contenedor de imágenes seleccionadas */
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            padding: 1rem;
            border: 2px dashed #cbd5e1; /* Borde punteado */
            border-radius: 0.75rem; /* Bordes redondeados */
            min-height: 150px;
            align-items: center;
            justify-items: center;
            background-color: #ffffff; /* Fondo blanco */
            overflow-y: auto; /* Permite desplazamiento si hay muchas imágenes */
            max-height: 400px; /* Altura máxima para el contenedor de previsualización */
        }
        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra suave */
        }
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Asegura que la imagen cubra el área sin distorsionarse */
        }
        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #ef4444; /* Rojo para el botón de eliminar */
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            z-index: 1000;
            backdrop-filter: blur(5px); /* Efecto de desenfoque */
            -webkit-backdrop-filter: blur(5px); /* Compatibilidad con Safari */
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db; /* Azul para el spinner */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 lg:p-10 min-h-screen flex flex-col items-center justify-center">
    <div class="max-w-3xl w-full bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-200">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-6">Convertidor de Imágenes a PDF</h1>

        <!-- Contenedor para seleccionar archivos -->
        <div class="mb-6">
            <label for="imageUpload" class="block text-gray-700 text-sm font-medium mb-2">
                Selecciona tus imágenes (JPG, PNG):
            </label>
            <input type="file" id="imageUpload" accept="image/jpeg, image/png" multiple
                   class="block w-full text-sm text-gray-500
                          file:mr-4 file:py-2 file:px-4
                          file:rounded-full file:border-0
                          file:text-sm file:font-semibold
                          file:bg-blue-50 file:text-blue-700
                          hover:file:bg-blue-100 cursor-pointer">
        </div>

        <!-- Contenedor para previsualizar imágenes seleccionadas -->
        <div id="imagePreviews" class="image-preview-container mb-6">
            <p class="text-gray-500 text-center w-full">Las imágenes seleccionadas aparecerán aquí.</p>
        </div>

        <!-- Botón para convertir a PDF -->
        <button id="convertBtn"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg
                       shadow-md transition duration-300 ease-in-out transform hover:scale-105
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
            Convertir a PDF
        </button>

        <!-- Área de mensajes -->
        <div id="messageArea" class="mt-4 text-center text-sm font-medium text-gray-600"></div>
    </div>

    <!-- Overlay de carga (oculto por defecto) -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Generando PDF, por favor espera...</p>
    </div>

    <!-- Incluye la librería jsPDF para la generación de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const imageUpload = document.getElementById('imageUpload');
        const imagePreviews = document.getElementById('imagePreviews');
        const convertBtn = document.getElementById('convertBtn');
        const messageArea = document.getElementById('messageArea');
        const loadingOverlay = document.getElementById('loadingOverlay');

        let selectedFiles = []; // Almacena los objetos File seleccionados

        // Función para mostrar mensajes al usuario
        function showMessage(message, type = 'info') {
            messageArea.textContent = message;
            messageArea.className = `mt-4 text-center text-sm font-medium`;
            if (type === 'error') {
                messageArea.classList.add('text-red-600');
            } else if (type === 'success') {
                messageArea.classList.add('text-green-600');
            } else {
                messageArea.classList.add('text-gray-600');
            }
        }

        // Función para actualizar las previsualizaciones de imágenes
        function updateImagePreviews() {
            imagePreviews.innerHTML = ''; // Limpiar previsualizaciones existentes
            if (selectedFiles.length === 0) {
                imagePreviews.innerHTML = '<p class="text-gray-500 text-center w-full">Las imágenes seleccionadas aparecerán aquí.</p>';
                return;
            }

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.dataset.index = index; // Para identificar la imagen al eliminar

                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = file.name;

                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-image-btn';
                    removeBtn.innerHTML = '&times;'; // Símbolo de "x"
                    removeBtn.onclick = () => {
                        // Eliminar la imagen del array selectedFiles
                        selectedFiles.splice(index, 1);
                        updateImagePreviews(); // Volver a renderizar las previsualizaciones
                        showMessage(`Imagen "${file.name}" eliminada.`);
                    };

                    previewItem.appendChild(img);
                    previewItem.appendChild(removeBtn);
                    imagePreviews.appendChild(previewItem);
                };
                reader.readAsDataURL(file); // Leer el archivo como URL de datos
            });
        }

        // Event listener para cuando se seleccionan archivos
        imageUpload.addEventListener('change', (event) => {
            const files = Array.from(event.target.files);
            if (files.length > 0) {
                // Agregar las nuevas imágenes a las ya seleccionadas
                selectedFiles = selectedFiles.concat(files);
                updateImagePreviews();
                showMessage(`${files.length} imagen(es) agregada(s). Total: ${selectedFiles.length}`);
            } else {
                showMessage('No se seleccionaron imágenes.');
            }
            // Limpiar el input para que se pueda seleccionar el mismo archivo de nuevo si se desea
            imageUpload.value = '';
        });

        // Event listener para el botón de convertir
        convertBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) {
                showMessage('Por favor, selecciona al menos una imagen para convertir.', 'error');
                return;
            }

            loadingOverlay.classList.remove('hidden'); // Mostrar overlay de carga
            showMessage('Generando PDF...', 'info');

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF(); // Crear un nuevo documento PDF

                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const reader = new FileReader();

                    // Usar una promesa para manejar la carga de cada imagen de forma asíncrona
                    await new Promise((resolve, reject) => {
                        reader.onload = (e) => {
                            const imgData = e.target.result;
                            const img = new Image();
                            img.onload = () => {
                                const imgWidth = img.width;
                                const imgHeight = img.height;

                                // Calcular las dimensiones para ajustar la imagen a la página PDF
                                const pageWidth = doc.internal.pageSize.getWidth();
                                const pageHeight = doc.internal.pageSize.getHeight();

                                const ratio = Math.min(pageWidth / imgWidth, pageHeight / imgHeight);
                                const scaledWidth = imgWidth * ratio;
                                const scaledHeight = imgHeight * ratio;

                                const x = (pageWidth - scaledWidth) / 2;
                                const y = (pageHeight - scaledHeight) / 2;

                                // Añadir una nueva página si no es la primera imagen
                                if (i > 0) {
                                    doc.addPage();
                                }
                                doc.addImage(imgData, 'JPEG', x, y, scaledWidth, scaledHeight);
                                resolve();
                            };
                            img.onerror = reject;
                            img.src = imgData;
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                }

                doc.save('mis-imagenes.pdf'); // Guardar el PDF con un nombre predeterminado
                showMessage(`PDF generado con ${selectedFiles.length} imagen(es).`, 'success');
                selectedFiles = []; // Limpiar las imágenes seleccionadas después de la conversión
                updateImagePreviews();
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                showMessage('Error al generar el PDF. Asegúrate de que las imágenes son válidas.', 'error');
            } finally {
                loadingOverlay.classList.add('hidden'); // Ocultar overlay de carga
            }
        });

        // Inicializar previsualizaciones al cargar la página
        window.onload = () => {
            updateImagePreviews();
        };
    </script>
</body>
</html>